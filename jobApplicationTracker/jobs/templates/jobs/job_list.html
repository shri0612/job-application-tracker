{% extends "base.html" %}

{% block content %}
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    .btn { padding: 4px 8px; text-decoration: none; border-radius: 4px; font-size: 14px; }
    .btn-edit { background: #f59e0b; color: white; }
    .btn-delete { background: #dc3545; color: white; }
    .btn-add { background: #0d6efd; color: white; margin-bottom: 12px; display: inline-block; }
    .badge { padding: 3px 8px; border-radius: 10px; font-size: 12px; }
    .Applied { background: #e7f1ff; color: #0d6efd; }
    .Interview { background: #fff8e1; color: #b45309; }
    .Offer { background: #e7f5e8; color: #2f855a; }
    .Rejected { background: #fde2e1; color: #c53030; }
    .Wishlist { background: #eee; color: #333; }
    .notes-cell { max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .view_btn { position: relative; }
    #notesModal { position: absolute; }
  </style>

  <div class="container py-4">
    <h1>All Jobs</h1>
    <p>Welcome, {{ user.username }}!</p>
    <a href="{% url 'add_job' %}" class="btn btn-add">+ Add New Job</a>

    {% if jobs %}
    <table>
      <thead>
        <tr>
          <th>Job Title</th>
          <th>Company</th>
          <th>Status</th>
          <th>Date Applied</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for job in jobs %}
        <tr>
          <td>{{ job.title }}</td>
          <td>{{ job.company }}</td>
          <td><span class="badge {{ job.status }}">{{ job.status }}</span></td>
          <td>{% if job.date_applied %}{{ job.date_applied|date:"d M Y" }}{% else %}—{% endif %}</td>
          <td>
            {% if job.notes %}
              <button class="view_btn" style="background:#0d6efd; padding:4px 8px; text-decoration:none; border-radius:4px; font-size:14px; border:none; color:white;"
                onclick="showNotes('{{ job.notes|escapejs }}')">View Notes</button>
              
              <!-- Full-screen overlay -->
              <div id="notesModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:1000;">
                <!-- Centered content box -->
                <div style="background:#fff; margin:10% auto; padding:20px; border:1px solid #ccc; width:450px; box-shadow:0 2px 10px rgba(0,0,0,0.3); position:relative;">
                  <span onclick="closeNotes()" style="position:absolute; top:0px; right:8px; font-size:33px; font-weight:bold; cursor:pointer;">&times;</span>
                  <h3>Full Notes</h3>
                  <p id="notesContent"></p>
                </div>
              </div>
            {% else %}
              —
            {% endif %}
          </td>
          <td>
            <a href="{% url 'edit_job' job.id %}" class="btn btn-edit">Edit</a>
            <a href="{% url 'delete_job' job.id %}" class="btn btn-delete">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>No jobs found. Start by adding one.</p>
    {% endif %}
  </div>

  <script>
    // Open modal
    function showNotes(noteText) {
      const modal = document.getElementById('notesModal');
      document.getElementById('notesContent').innerText = noteText;
      modal.style.display = 'block';
    }

    // Close modal (button)
    function closeNotes() {
      document.getElementById('notesModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('notesModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    }
  </script>
{% endblock %}
